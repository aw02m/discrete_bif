Bifurcation analysis program for difference equations (descrete dynamical systems).

See aw02m/bifurcation_theory for the calcuration algorythm.

更新しました．(Oct/21/2021; fixとbifの統合，json出力の自動化)
現在数値微分は使用不可です．そのうち実装予定．

# descrete_bif
離散力学系(差分方程式)の分岐解析ツールです．  
本プログラムは2部に分かれています:

1. pp (Phase portrait; 相平面描画ツール)
2. bif (Bifurcation; 分岐集合追跡 + 固定点追跡)

## pp概要
ppは相平面をリアルタイムに描画します．(Original:Tetsushi Ueta)
固定点計算のための近似値取得に使用してください．  

### 動作環境
* numpy
* scipy
* matplotlib

### pp入力ファイル要素
* "xrange", "yrange" : x,y描画区間．
* "alpha" : 打点の透明度(alpha値)．0~1の範囲．
* "break" : 一回の描画に計算するステップ数．2000以上は重いかも．
* "x0" : プログラム実行時の初期値．
* "params" : 力学系のパラメタ．
* "dparams" : プログラム内でパラメタを変更する際の刻み幅．
* "explode" : 座標が発散したと判定するまでのノルム値．
* "func" : ここに差分方程式を書き込みます．pythonの文法に則って記述してください．ただしパラメタは`data.dict['params'][i]`で表記します．内部的にはこのフィールドの文字列がpython内で`eval()`されます．

### 使用法
`$ python pp.py [json input file]`で実行．プログラム実行中は次のキーを押下することで各種パラメタ変更，ファイル出力等が行えます．
* `w` : `__ppout__.json`ファイルに現在の情報を保存します．ファイルがすでに存在している場合は上書きされます．
* `p` : 変化させるパラメタを指定します．現在の指定インデックスはターミナルに表示されます．
* `[矢印キー]` : 指定しているパラメタを"dparams"に従って変化させます．
* `[space]` : 描画をリセットします．
* その他の機能についてはProf. Uetaのオリジナルリポジトリを参照ください．

## fix概要
fixはppで取得した固定点情報をもとに，一つの指定パラメタを変化させながらNewton法を用いて固定点計算を行います．

### 動作環境
* Eigen-3.4-rc1 : 線形代数ライブラリです．現在のstableに実装されていない関数を使用しているため，gitリポジトリの最新バージョンを利用してください．Arch Linuxなひとは`# pamac build eigen-git`でインストールされます．
* nlohmann-3.10.1 : jsonライブラリ．
* cmake : Makefileの自動生成に用います．

### 入力ファイル概要


### 使用法


## bif概要
`bif`は`fix`で求めた分岐点の近似値をもとに分岐集合を計算します．`bif`, `bif_ns`にそれぞれプログラムが別れていますが，中身はほとんど一緒です．
`bif`はPeriod-doubling bifurcation; PD及びTangent bifurcation; Gの計算が可能です．
`bif_ns`はNeimark-Sacker; NS分岐用ですが，アルゴリズムの特性上PDもGも計算できます．

### bif, bif_ns入力ファイル概要
* "fix_mode" : trueの場合固定点追跡を行います．
* "x0" : ppにてjsonファイルを出力した際に更新されます．この値が固定点計算の初期値として使用されます．
* "theta" : 分岐点特性定数の偏角を与えます．
* "period" : 固定点の周期を指定します．ppにて周期を確認して正確な整数値を与えてください．
* "inc_param" : 増加させるパラメタを指定します．"params"のインデックスで指定してください．
* "var_param" : 変数として扱うパラメタを指定します．
* "delta_inc" : パラメタ変分量です．経験的に0.1~0.0001の範囲で設定すると良いです．あまりに収束しない場合は増分パラメタの変更もしくは刻みを小さくしてください．
* "inc_iter" : 指定した回数固定点を計算します．(指定した計算回数に到達もしくは発散しないとプログラムは固定点を計算し続けます．)
* "max_iter" : Newton法の最大ステップを指定します．Newton法は通常数回の繰り返しで収束するため，10~32の整数値を指定します．
* "eps" : Newton法の収束判定を与えます．誤差が指定数値以下になった場合に計算が終了します．10^-8くらい．
* "numerical_diff" : `bool`値を指定します．`true`の場合2階変分は数値微分により計算され，`false`の場合は代数的に求められます．
* "dif_strip" : 数値微分を用いる際の微小量を指定します．本バージョンでは2階微分に一部数値微分が使用されています．

### 使用法
`./main [input json file]`にて実行．コンパイルは`mkdir build`の後`bif/build`ディレクトリの中で`cmake ../`するとMakefileが自動で作成されますので，その後`make`で実行ファイルが生成されます．
力学系の写像及びその微分は`sys_func.cpp`に記述し，それ以外のC++ファイルは変更しないでください．
なお，`Eigen`配列へのアクセスは`[i]`ではなく`(i)`を用いてください．こっちのほうが早いらしいです．
計算に成功すると固定点座標，パラメタ値，特性定数，特性定数のノルム・偏角が出力されます．
分岐計算の最終点はカレントディレクトリにout.jsonとして書き出されます．
収束しなかった場合は増分パラメタと変分パラメタを入れ替えるなどして追跡継続を試してください．
